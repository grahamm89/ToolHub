<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Detergent Concentration Tool</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img src="../../assets/logo.svg" class="logo" alt="logo">
      <div>
        <h1>Detergent Concentration Tool</h1>
        <p class="muted">Drop → g/L lookup • Offline</p>
      </div>
    </div>
  </header>

  <main class="content">
    <label for="productSelect"><strong>Select a product:</strong></label>
    <select id="productSelect" size="8" aria-describedby="chlorinatedWarning"></select>

    <div id="chlorinatedWarning" class="card" style="border-left:5px solid #ffc107; background:#fff3cd; display:none">
      <strong>Note:</strong> Chlorinated product — add 3 drops of Sodium Thiosulphate in Step 2.
    </div>

    <div class="grid" style="overflow-x:auto">
      <table id="resultTable" class="card" style="display:none">
        <thead>
          <tr>
            <th>Concentration</th><th>0.5 g/L</th><th>1.0 g/L</th><th>1.5 g/L</th><th>2.0 g/L</th><th>3.0 g/L</th><th>6.0 g/L</th>
          </tr>
        </thead>
        <tbody>
          <tr id="dropRow"><td>Drops</td><td id="c0"></td><td id="c1"></td><td id="c2"></td><td id="c3"></td><td id="c4"></td><td id="c5"></td></tr>
        </tbody>
      </table>
    </div>

    <section id="instructions" class="card" style="display:none">
      <h3>Instructions</h3>
      <ol>
        <li>Fill the test tube to the 5 ml mark with water from the wash tank.</li>
        <li id="chlorineStep" style="display:none">Add 3 drops of Sodium Thiosulphate.</li>
        <li>Add 1 drop of Indicator Reagent — solution will turn pink.</li>
        <li>Select the correct acid by reference to table 3 (ACID 3 is 4 × strength of ACID 1).</li>
        <li>Add the ACID 1 or 3 a drop at a time, holding dropper bottle vertically. Swirl after each addition.</li>
        <li>Continue until the colour changes from pink to colourless.</li>
        <li>Count number of drops and read product concentration from table 2.</li>
      </ol>
    </section>
  </main>

  <script>
  (function(){
    const selectEl = document.getElementById('productSelect');
    const tableEl = document.getElementById('resultTable');
    const warnEl = document.getElementById('chlorinatedWarning');
    const instrEl = document.getElementById('instructions');
    const chlorineStep = document.getElementById('chlorineStep');

    fetch('./products.json?_=' + Date.now(), { cache:'no-store' })
      .then(r=>r.json())
      .then(data => {
        data.forEach(({name, chlorinated, drops})=>{
          const opt = new Option(name, name);
          opt.dataset.chlorinated = chlorinated;
          opt.dataset.drops = JSON.stringify(drops);
          selectEl.add(opt);
        });
      });

    selectEl.addEventListener('change', e=>{
      const opt = e.target.selectedOptions[0];
      if(!opt) return;
      const drops = JSON.parse(opt.dataset.drops);
      drops.forEach((val,i)=>{
        const cell = document.getElementById('c'+i);
        if (cell) cell.textContent = val || '–';
      });
      tableEl.style.display='table';
      instrEl.style.display='block';
      const chlor = opt.dataset.chlorinated === 'true';
      warnEl.style.display = chlor ? 'block' : 'none';
      chlorineStep.style.display = chlor ? 'list-item' : 'none';
    });
  })();
  </script>
</body>
</html>
